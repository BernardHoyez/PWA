<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Montrek - G√©n√©rateur OSMand</title>
    <meta name="theme-color" content="#2563eb" />
    <link rel="icon" type="image/png" sizes="192x192" href="icon192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="icon512.png" />
    <link rel="apple-touch-icon" href="icon192.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.min.js"></script>

    <style>
      /* ton CSS inchang√© ici */
      /* ... */
      #map {
          width: 100%;
          height: 400px;
          border-radius: 15px;
          margin-top: 20px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      /* ... */
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèîÔ∏è Montrek</h1>
            <p>G√©n√©rateur de cartes OSMand (.sqlitedb)</p>
        </div>

        <div class="content">
            <!-- tes sections inchang√©es -->
            <!-- ... -->

            <div id="map"></div>

            <!-- reste du HTML identique -->
            <!-- ... -->
        </div>
    </div>

<script>
    let map, centerMarker;
    let centerLat = 49.515,
      centerLon = 0.107;
    let circleLayer;
    let directoryHandle = null;
    let currentTileSource = 'osm';
    let tileLayer;

    function initMap() {
      map = L.map('map').setView([centerLat, centerLon], 13);
      tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors',
        maxZoom: 19
      }).addTo(map);

      centerMarker = L.marker([centerLat, centerLon], { draggable: false }).addTo(map);

      circleLayer = L.circle([centerLat, centerLon], {
        radius: 5000,
        color: '#2563eb',
        fillColor: '#3b82f6',
        fillOpacity: 0.2
      }).addTo(map);

      map.on('click', function(e) {
        centerLat = e.latlng.lat;
        centerLon = e.latlng.lng;
        updateCenter();
      });
    }

    function changeTileSource() {
      currentTileSource = document.getElementById('tileSource').value;
      if (tileLayer) {
        map.removeLayer(tileLayer);
      }

      if (currentTileSource === 'osm') {
        tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors',
          maxZoom: 19
        }).addTo(map);
      } else if (currentTileSource === 'ign') {
        tileLayer = L.tileLayer(
          'https://data.geopf.fr/wmts?' +
          'SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0' +
          '&LAYER=GEOGRAPHICALGRIDSYSTEMS.PLANIGNV2&STYLE=normal&FORMAT=image/png' +
          '&TILEMATRIXSET=PM&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}', {
            attribution: '¬© IGN - Plan v2',
            maxZoom: 19,
            minZoom: 0
          }
        ).addTo(map);
      }
    }

    function updateCenter() {
      centerMarker.setLatLng([centerLat, centerLon]);
      circleLayer.setLatLng([centerLat, centerLon]);
      map.setView([centerLat, centerLon]);
      document.getElementById('lat').value = centerLat.toFixed(6);
      document.getElementById('lon').value = centerLon.toFixed(6);
      document.getElementById('centerInfo').innerHTML = `<p><strong>Centre actuel:</strong> Lat: ${centerLat.toFixed(6)}, Lon: ${centerLon.toFixed(6)}</p>`;
    }

    function setCenterManual() {
      centerLat = parseFloat(document.getElementById('lat').value);
      centerLon = parseFloat(document.getElementById('lon').value);
      updateCenter();
    }

    function setCenterGPS() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          centerLat = position.coords.latitude;
          centerLon = position.coords.longitude;
          updateCenter();
        }, function(error) {
          alert('Erreur de g√©olocalisation: ' + error.message);
        });
      } else {
        alert('La g√©olocalisation n\'est pas support√©e par ce navigateur.');
      }
    }

    function updateRadius() {
      const radius = parseFloat(document.getElementById('radius').value);
      document.getElementById('radiusValue').textContent = radius + ' km';
      circleLayer.setRadius(radius *
