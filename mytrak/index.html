<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>mytrak</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2c3e50">

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<header>
  <h1>mytrak</h1>
  <div id="status">Aucun dossier sélectionné</div>
</header>

<!-- ÉTAPE 1 -->
<section id="step-folder">
  <p><strong>Le dossier « mes traces de randos » existe-t-il déjà ?</strong></p>
  <button id="btn-select">Oui, le sélectionner</button>
  <button id="btn-create">Non, le créer</button>
</section>

<!-- ÉTAPE 2 -->
<section id="step-map" style="display:none">
  <div id="map"></div>
  <div style="padding:10px">
    <p><strong>La représentation vous convient-elle ?</strong></p>
    <button onclick="exportHTML()">Oui, exporter la carte</button>
    <button onclick="location.reload()">Non, revenir au dossier</button>
  </div>
</section>

<!-- LOGIQUE -->
<script src="app.js"></script>

<script>
/* =========================
   Gestion UI (après app.js)
   ========================= */

document.getElementById("btn-select").addEventListener("click", async () => {
  try {
    await selectFolder(false);
    afficherCarte();
  } catch (e) {
    console.error(e);
  }
});

document.getElementById("btn-create").addEventListener("click", async () => {
  try {
    const parent = await window.showDirectoryPicker();
    directoryHandle = await parent.getDirectoryHandle(
      "mes traces de randos",
      { create: true }
    );

    document.getElementById("status").textContent =
      "Dossier créé : mes traces de randos";

    await parseTraces();
    afficherCarte();
  } catch (e) {
    console.error(e);
  }
});

function afficherCarte() {
  document.getElementById("step-folder").style.display = "none";
  document.getElementById("step-map").style.display = "block";
  initMap();
}

/* =========================
   Service Worker
   ========================= */
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>

</body>
</html>
